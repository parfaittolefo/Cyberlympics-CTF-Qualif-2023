![image](https://github.com/parfaittolefo/Cyberlympics-CTF-Qualif-2023/assets/103222152/97b3cba1-29b0-4c1b-a259-55040c1ab113)# Binary Exploitation
# √ânonc√©

<d√©tails><summary>√ânonc√©</summary>

**Pts¬†: 150**

Banque de drapeaux

Bienvenue √† la Flag Bank, o√π tout est possible !

Format de l'indicateur : acdfCTF{}

 nc 13.49.65.175 9002

 Fichier Associ√©: https://github.com/parfaittolefo/Cyberlympics-CTF-Qualif-2023/blob/main/chal_files/Flag_Bank

</d√©tails>

# Solution
<d√©tails><summary>Solution</summary>
 Mais tout d'abord nous avons lancer la connection netcat afin de voir a peu pret que pouvait etre notre vecteur d'attaque .
 
<img src='https://github.com/parfaittolefo/Cyberlympics-CTF-Qualif-2023/blob/main/img/Capture%20d%E2%80%99%C3%A9cran%20du%202023-09-25%2005-13-11.png'>

A ce challenge a √©t√© associer un executable ELF ce qui nous permettra de voir beaucoup plus en profondeur le fonctionnement du programme. Allons desassembler le programme avec GHIDRA üòâ....

<img src='https://github.com/parfaittolefo/Cyberlympics-CTF-Qualif-2023/blob/main/img/Capture%20d%E2%80%99%C3%A9cran%20du%202023-09-25%2005-25-35.png'>

Une fois le programme desassembler sous ghidra , nous allons directement nous rendre dans la fonction main (principale) du programme et essayer de comprendre ce qui se passe a l'interieur. Voici un a quoi ressemble notre fonction main ...

 
void main(EVP_PKEY_CTX *param_1)

{
  int iVar1;
  int local_2c;
  int local_28;
  char local_21;
  FILE *local_20;
  uint local_18;
  uint local_14;
  int local_10;
  uint local_c;
  
  init(param_1);
  puts(&DAT_00102008);
  local_14 = 20000;
  local_18 = 3000;
  local_c = 10000;
  do {
    puts("[1] Purchase Flag - $20000\n[2] Purchase Test Flag - $3000\n[3] View current balance");
    __isoc99_scanf(&DAT_001020e3,&local_2c);
    getc(stdin);
    if (local_2c == 1) {
      if (local_14 <= local_c) {
        puts("Number of flags do you need? ");
        __isoc99_scanf(&DAT_001020e3,&local_28);
        getc(stdin);
        local_20 = fopen("flag.txt","r");
        if (local_20 != (FILE *)0x0) {
          while( true ) {
            iVar1 = fgetc(local_20);
            local_21 = (char)iVar1;
            if (local_21 == -1) break;
            putchar((int)local_21);
          }
          local_c = local_c - local_28 * local_14;
          fclose(local_20);
                    /* WARNING: Subroutine does not return */
          exit(0);
        }
        puts("Content of flag not found!");
                    /* WARNING: Subroutine does not return */
        exit(0);
      }
      if (local_c < local_14) {
        puts("You don\'t have enough money to purchase a Flag");
                    /* WARNING: Subroutine does not return */
        exit(0);
      }
    }
    if (local_2c == 2) {
      if (local_c < local_18) {
        puts("You don\'t have enough money to purchase a Test Flag");
      }
      else {
        puts("Number of Test Flags do you need? ");
        __isoc99_scanf(&DAT_001020e3,&local_28);
        getc(stdin);
        local_c = local_c - local_28 * local_18;
        for (local_10 = 0; local_10 < local_28; local_10 = local_10 + 1) {
          puts("acdfCTF{fak3_flag_1s_n0t_th3_fl4g}");
        }
      }
    }
    if (local_2c == 3) {
      printf("$%i\n",(ulong)local_c);
    }
  } while( true );
} 

Comme il est observable, le code nous offre la possibilit√© d'acqu√©rir un drapeau au co√ªt de 20 000 $, acheter un drapeau de test √† 3 000 $, et de consulter notre solde actuel, qui s'√©l√®ve √† 10 000 $ . Notre objectif principal consiste donc √† accro√Ætre notre vente afin de pouvoir porter le drapeau. Cependant, il est essentiel de pr√™ter une attention particuli√®re √† la fonction principale (main) du programme, car une condition sp√©cifique tenue notre int√©r√™t.

 <img src='https://github.com/parfaittolefo/Cyberlympics-CTF-Qualif-2023/blob/main/img/Capture%20d%E2%80%99%C3%A9cran%20du%202023-09-25%2006-01-06.png'>
 
Il est remarquable qu'aucune validation de saisie n'est mise en place pour la variable local_28. Cela signifie que l'utilisateur pourrait entrer √† la fois des valeurs positives et des valeurs n√©gatives. Cela aurait pour cons√©quence d'ex√©cuter le code de la mani√®re suivante : local_c = local_c - (valeur n√©gative) * local_18. √âtant donn√© que la multiplication √† la priorit√© dans ce calcul, cela entra√Ænerait une multiplication entre un nombre n√©gatif et une valeur positive pr√©d√©finie.

C'est l√† que √ßa devient int√©ressant. Retournons maintenant √† notre connexion Netcat et testons cette hypoth√®se pour voir ce qui se passe.üèÉüèÉüèÉüèÉüèÉ

<img src='https://github.com/parfaittolefo/Cyberlympics-CTF-Qualif-2023/blob/main/img/Capture%20d%E2%80%99%C3%A9cran%20du%202023-09-25%2006-22-20.png'>

**DRAPEAU¬†:** _acdfCTF{1_s33_wh47_y0u_d1d_r1gh7_th3r3}_

</d√©tails>
