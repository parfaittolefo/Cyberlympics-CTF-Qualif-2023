# Binary_Exploitation
# Énoncé

<détails><summary>Énoncé</summary>

**Pts : 150**

Welcome to Flag Bank, where anything is possible!

Indicator format: acdfCTF{}

 nc 13.49.65.175 9002

 Fichier Associé: https://github.com/parfaittolefo/Cyberlympics-CTF-Qualif-2023/blob/main/chal_files/Flag_Bank

</détails>

# Solution
<détails><summary>Solution</summary>
But first of all we launched the netcat connection in order to roughly see what our attack vector could be.

 ![Capture d’écran du 2023-09-25 05-13-11](https://github.com/parfaittolefo/Cyberlympics-CTF-Qualif-2023/assets/103222152/9162db39-b77b-4602-9dc1-3ec6639245d0)

An ELF executable was associated with this challenge, which will allow us to see in much greater depth how the program works. Let's disassemble the program with GHIDRA 😉....

![Capture d’écran du 2023-09-25 05-25-35](https://github.com/parfaittolefo/Cyberlympics-CTF-Qualif-2023/assets/103222152/94fce1ba-5a24-479f-89ba-49cd126a840b)

Once the program has been disassembled in ghidra, we will go directly to the main (main) function of the program and try to understand what is happening inside. Here's what our main function looks like...

{void main(EVP_PKEY_CTX *param_1)

{

  int iVar1;
  
  int local_2c;
  
  int local_28;
  
  char local_21;
  
  FILE *local_20;
  
  uint local_18;
  
  uint local_14;
  
  int local_10;
  
  uint local_c;
  
  
  init(param_1);
  
  puts(&DAT_00102008);
  
  local_14 = 20000;
  
  local_18 = 3000;
  
  local_c = 10000;
  
  do {
  
    puts("[1] Purchase Flag - $20000\n[2] Purchase Test Flag - $3000\n[3] View current balance");
    
    __isoc99_scanf(&DAT_001020e3,&local_2c);
    
    getc(stdin);
    
    if (local_2c == 1) {
    
      if (local_14 <= local_c) {
      
        puts("Number of flags do you need? ");
        
        __isoc99_scanf(&DAT_001020e3,&local_28);
        
        getc(stdin);
        
        local_20 = fopen("flag.txt","r");
        
        if (local_20 != (FILE *)0x0) {
        
          while( true ) {
          
            iVar1 = fgetc(local_20);
            
            local_21 = (char)iVar1;
            
            if (local_21 == -1) break;
            
            putchar((int)local_21);
            
          }
          
          local_c = local_c - local_28 * local_14;
          
          fclose(local_20);
          
                    /* WARNING: Subroutine does not return */
                    
          exit(0);
          
        }
        
        puts("Content of flag not found!");
        
                    /* WARNING: Subroutine does not return */
                    
        exit(0);
        
      }
      
      if (local_c < local_14) {
      
        puts("You don\'t have enough money to purchase a Flag");
        
                    /* WARNING: Subroutine does not return */
                    
        exit(0);
        
      }
      
    }
    
    if (local_2c == 2) {
    
      if (local_c < local_18) {
      
        puts("You don\'t have enough money to purchase a Test Flag");
        
      }
      
      else {
      
        puts("Number of Test Flags do you need? ");
        
        __isoc99_scanf(&DAT_001020e3,&local_28);
        
        getc(stdin);
        
        local_c = local_c - local_28 * local_18;
        
        for (local_10 = 0; local_10 < local_28; local_10 = local_10 + 1) {
        
          puts("acdfCTF{fak3_flag_1s_n0t_th3_fl4g}");
          
        }
        
      }
      
    }
    
    if (local_2c == 3) {
    
      printf("$%i\n",(ulong)local_c);
      
    }
    
  } while( true );
  
} 

As it is observable, the code offers us the possibility to acquire a flag at a cost of $20,000, purchase a test flag at $3,000, and view our current balance, which stands at $10,000. So our main goal is to increase our sales so that we can carry the flag. However, it is essential to pay close attention to the main (main) function of the program, because a specific condition holds our interest.

![Capture d’écran du 2023-09-25 06-01-06](https://github.com/parfaittolefo/Cyberlympics-CTF-Qualif-2023/assets/103222152/8cb88364-4736-423d-af14-c658476080db)
 
It is remarkable that no input validation is implemented for the local_28 variable. This means that the user could enter both positive and negative values. This would result in executing the code as follows: local_c = local_c - (negative value) * local_18. Since multiplication takes priority in this calculation, this would result in a multiplication between a negative number and the positive value of local_18 predefined to 3000.

This is where it gets interesting. Now let's go back to our Netcat connection and test this hypothesis to see what happens.🏃🏃🏃🏃🏃
<img src='https://github.com/parfaittolefo/Cyberlympics-CTF-Qualif-2023/blob/main/img/Capture%20d%E2%80%99%C3%A9cran%20du%202023-09-25%2006-22-20.png'>

**DRAPEAU :** _acdfCTF{1_s33_wh47_y0u_d1d_r1gh7_th3r3}_

</détails>
